# Test Plan — Stage 1 (file-based sync)

Цель: ручная проверка acceptance criteria из `docs/release_plan_stage1.md` для провайдеров **Dropbox / Yandex Disk / WebDAV (NAS)**.

## Подготовка

- В debug-сборке открой `Настройки → Диагностика` и нажми `Сбросить синхронизацию` (для “чистого” теста).
- Убедись, что `Настройки → Синхронизация` показывает нужного провайдера и статус подключения.

## AC1 — Fresh install + подключение → первая синхронизация без крашей

Повтори для каждого провайдера:

1) Выбери провайдера.  
2) Нажми `Подключить` (для WebDAV — заполни URL/логин/пароль).  
3) Нажми `Синхронизировать сейчас`.  

Ожидаемо:
- Приложение не падает.
- В блоке статуса синхронизации отображается успешный результат или понятная ошибка.

## AC2 — Отсутствие файлов в облаке (404) не показывает ошибок пользователю

1) Подключи провайдера к “пустому” хранилищу (без `event_log.json/state.json/books_index.json`).  
2) Нажми `Синхронизировать сейчас`.  

Ожидаемо:
- Ошибка пользователю не показывается из-за 404; создаются/используются пустые данные.
- В логе есть записи `... not found, using empty` (это нормально).

## AC3 — Загрузка нескольких книг без таймаутов (2–5 минут)

1) Импортируй 3–5 книг (желательно 1–2 больших файла).  
2) Нажми `Синхронизировать сейчас`. Засеки время до статуса “успех”.  

Ожидаемо:
- Нет таймаутов (ориентир: до 2–5 минут на обычном соединении).
- При повторной синхронизации `uploaded` близок к нулю (если изменений не было).

## AC4 — Сетевая ошибка: автосинк отключается и предлагает восстановление

1) Подключи провайдера.  
2) Отключи сеть (Wi‑Fi/интернет) или подмени URL (для WebDAV).  
3) Дождись/вызови автосинк или нажми `Синхронизировать сейчас`.  

Ожидаемо:
- Появляется понятное сообщение (без токенов/секретов).
- Автосинк отключается и предлагает `Повторить`/`Переподключить`.
- После восстановления сети `Повторить` приводит к успешной синхронизации.

## Диагностика (если что-то пошло не так)

- `Настройки → Диагностика → Копировать путь` (или `Открыть папку`) и приложить `cogniread.log`.
- Убедиться, что в логе нет секретов (токены/пароли должны быть скрыты).

