# –ú–∞–∫–µ—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ Entities

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π (loading/empty/error/offline/sync) –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –¥–æ–º–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, —á—Ç–æ–±—ã UI –∏ –¥–æ–º–µ–Ω ‚Äú—Å–æ—à–ª–∏—Å—å‚Äù –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–∏–Ω–∫–∞/AI/–≥—Ä–∞—Ñ–∞.

---

## 1) –®–∞–±–ª–æ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π (–µ–¥–∏–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞)

### Loading
- Skeleton –≤–º–µ—Å—Ç–æ —Å–ø–∏–Ω–Ω–µ—Ä–∞ (–æ–±–ª–æ–∂–∫–∏/—Å—Ç—Ä–æ–∫–∏/–∫–∞—Ä—Ç–æ—á–∫–∏/–∞–±–∑–∞—Ü—ã).
- –ï—Å–ª–∏ –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–µ—à: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º stale‚ÄëUI + –º–∞–ª–µ–Ω—å–∫–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

### Empty
- 1 —Å—Ç—Ä–æ–∫–∞ ‚Äú—á—Ç–æ —ç—Ç–æ‚Äù, 1‚Äì2 CTA, –ø–æ–¥—Å–∫–∞–∑–∫–∞ ‚Äú–∫–∞–∫ –∑–∞–ø–æ–ª–Ω–∏—Ç—å‚Äù.
- –î–ª—è –ø—É—Å—Ç–æ–≥–æ –ø–æ–∏—Å–∫–∞: –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ + ‚Äú–Ω–µ–¥–∞–≤–Ω–∏–µ‚Äù.

### Error
- –í–≤–µ—Ä—Ö—É ErrorBanner —Å –ø—Ä–∏—á–∏–Ω–æ–π + –∫–Ω–æ–ø–∫–∞ ‚Äú–ü–æ–≤—Ç–æ—Ä–∏—Ç—å‚Äù.
- –û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∞ –∫–Ω–∏–≥–∏: –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω —Å ‚Äú–û—Ç–∫—Ä—ã—Ç—å –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª / –ü–µ—Ä–µ–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å / –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥‚Äù.

### Offline / Syncing
- –ú–∞–ª–µ–Ω—å–∫–∏–π OfflineBadge (–Ω–µ –º–æ–¥–∞–ª–∫–∞) + ‚Äú–∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ‚Äù.
- –ü—Ä–∏ —Å–∏–Ω–∫–µ: —Å—Ç–∞—Ç—É—Å ‚Äú–û—á–µ—Ä–µ–¥—å N‚Äù + ‚Äú–ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ ‚Ä¶‚Äù.

---

## 2) –ú–∞–∫–µ—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ —ç–∫—Ä–∞–Ω–∞–º

### A) LibraryScreen
**Loading**: skeleton grid/list (6‚Äì10 –æ–±–ª–æ–∂–µ–∫ + —Å—Ç—Ä–æ–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö).  
**Empty**: ‚Äú–ü–æ–∫–∞ –Ω–µ—Ç –∫–Ω–∏–≥‚Äù, CTA ‚Äú–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å EPUB/PDF‚Äù, –ø–æ–¥—Å–∫–∞–∑–∫–∞ drag&drop (desktop).  
**Error**: ‚Äú–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É‚Äù, –∫–Ω–æ–ø–∫–∏ ‚Äú–ü–æ–≤—Ç–æ—Ä–∏—Ç—å‚Äù, ‚Äú–û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É‚Äù.  
**Offline**: ‚Äú–û—Ñ–ª–∞–π–Ω ‚Ä¢ –∏–º–ø–æ—Ä—Ç –¥–æ—Å—Ç—É–ø–µ–Ω ‚Ä¢ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∂–µ‚Äù.

### B) ImportScreen
**Loading**: —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á (–ø—Ä–æ–≤–µ—Ä–∫–∞/–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ/—Ä–∞–∑–±–æ—Ä –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è), –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ñ–∞–π–ª—É.  
**Error (–Ω–∞ —Ñ–∞–π–ª)**: ‚Äú–ù–µ —á–∏—Ç–∞–µ—Ç—Å—è / –ø–æ–≤—Ä–µ–∂–¥–µ–Ω‚Äù, –¥–µ–π—Å—Ç–≤–∏—è ‚Äú–ü–æ–≤—Ç–æ—Ä–∏—Ç—å‚Äù, ‚Äú–î—Ä—É–≥–æ–π —Ñ–∞–π–ª‚Äù, ‚Äú–û—Ç—á–µ—Ç‚Äù.  
**Offline**: –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω; –æ–±–ª–∞—á–Ω—ã–π ‚Äî —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.

### C) BookDetailsScreen
**Loading**: skeleton hero + —Å–ø–∏—Å–æ–∫ –≥–ª–∞–≤.  
**Empty (TOC)**: ‚Äú–û–≥–ª–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ‚Äù + CTA ‚Äú–û—Ç–∫—Ä—ã—Ç—å –∫–Ω–∏–≥—É‚Äù.  
**Error**: ‚Äú–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–Ω–∏–≥–∏‚Äù + ‚Äú–ü–æ–≤—Ç–æ—Ä–∏—Ç—å‚Äù; –Ω–µ—Ç —Ñ–∞–π–ª–∞ ‚Üí ‚Äú–ü–µ—Ä–µ–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å‚Äù.  
**Offline**: –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã; AI ‚Äî –∫–µ—à/–∑–∞–≥–ª—É—à–∫–∞.

### D) ReaderScreen
**Loading**: –∫–∞—Ä–∫–∞—Å —Ä–∏–¥–µ—Ä–∞ + shimmer –∞–±–∑–∞—Ü–µ–≤.  
**Empty**: ‚Äú–≠—Ç–∞ —á–∞—Å—Ç—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç–∞‚Äù + –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –≥–ª–∞–≤–µ.  
**Error (—Ä–µ–Ω–¥–µ—Ä)**: —ç–∫—Ä–∞–Ω —Å 3 –¥–µ–π—Å—Ç–≤–∏—è–º–∏: –æ—Ç–∫—Ä—ã—Ç—å –¥—Ä—É–≥—É—é –∫–Ω–∏–≥—É, –ø–µ—Ä–µ–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥.  
**Offline**: badge ‚Äú–û—Ñ–ª–∞–π–Ω‚Äù, AI ‚Äî –∫–µ—à/—Å–∫—Ä—ã—Ç–æ.  
**Syncing**: –∏–∫–æ–Ω–∫–∞ —Å–∏–Ω–∫–∞ –≤ —Ç—É–ª–±–∞—Ä–µ ‚Üí SyncStatus.

### E) TocDrawer / SearchInBookSheet
**TOC Loading**: skeleton list (—Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π).  
**TOC Empty**: ‚Äú–û–≥–ª–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ‚Äù + ‚Äú–ü–æ–∏—Å–∫ –ø–æ –∫–Ω–∏–≥–µ‚Äù.  
**Search Loading**: ‚Äú–ò—â–µ–º‚Ä¶‚Äù + —Å—á–µ—Ç—á–∏–∫.  
**Search Empty**: ‚Äú–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ‚Äù + –ø–æ–¥—Å–∫–∞–∑–∫–∏.  
**Error**: ‚Äú–ü–æ–∏—Å–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞‚Äù.

### F) CreateNoteSheet / NoteEditor
**Loading**: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ ‚Äú—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ‚Ä¶‚Äù.  
**Empty**: ‚Äú–î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Äî –≤—ã–¥–µ–ª–∏—Ç–µ —Ç–µ–∫—Å—Ç‚Äù + ‚Äú–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á—Ç–µ–Ω–∏—é‚Äù.  
**Error**: ‚Äú–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å‚Äù + ‚Äú–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç‚Äù.  
**Offline**: ‚Äú–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ‚Äù.

### G) NotesScreen
**Loading**: skeleton cards.  
**Empty**: ‚Äú–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–º–µ—Ç–æ–∫‚Äù + CTA ‚Äú–û—Ç–∫—Ä–æ–π—Ç–µ –∫–Ω–∏–≥—É‚Äù.  
**Error**: ‚Äú–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–º–µ—Ç–∫–∏‚Äù + ‚Äú–ü–æ–≤—Ç–æ—Ä–∏—Ç—å‚Äù.  
**Offline/Syncing**: —Ñ–∏–ª—å—Ç—Ä ‚Äú–¢–æ–ª—å–∫–æ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ‚Äù.

### H) GlobalSearchScreen
**Loading**: skeleton —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.  
**Empty (–Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–∞)**: –Ω–µ–¥–∞–≤–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã + —á–∏–ø—ã.  
**Empty (–ø–æ –∑–∞–ø—Ä–æ—Å—É)**: ‚Äú–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ‚Äù + ‚Äú–ò—Å–∫–∞—Ç—å –ø–æ –∫–Ω–∏–≥–µ‚Äù.  
**Error**: ‚Äú–ü–æ–∏—Å–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω‚Äù + ‚Äú–ü–µ—Ä–µ—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω–¥–µ–∫—Å‚Äù.

### I) Settings / SyncStatus / ConflictResolver
**Settings**: –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å—Ç–æ—Ä–∞.  
**SyncStatus**: —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚úÖ/üü°/üî¥ + –ª–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π.  
**ConflictResolver**: 2 –∫–æ–ª–æ–Ω–∫–∏ + ‚Äú–û—Å—Ç–∞–≤–∏—Ç—å –º–æ—é/–∏—Ö/–û–±—ä–µ–¥–∏–Ω–∏—Ç—å‚Äù.

---

## 3) –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ Entities (Domain)

### Core —á—Ç–µ–Ω–∏—è

**Book**
- id
- title, author, language?
- format = epub | pdf
- coverUri?
- createdAt, updatedAt, lastOpenedAt?
- progress (0..1) –∏–ª–∏ –≤—ã—á–∏—Å–ª—è–µ–º—ã–π

**BookAsset**
- bookId
- localPath
- remoteUri?
- mimeType, sizeBytes, checksum

**TocItem / Chapter**
- id, bookId
- title
- order, depth
- startLocator, endLocator?

**ReadingPosition**
- bookId
- locatorType: EPUB = CFI, PDF = page+offset?
- locator (—Å—Ç—Ä–æ–∫–∞)
- chapterId?
- percentage?
- updatedAt
- deviceId?

---

### –í—ã–¥–µ–ª–µ–Ω–∏—è –∏ –∑–∞–º–µ—Ç–∫–∏

**Highlight**
- id, bookId, chapterId?
- rangeStart, rangeEnd (—Ñ–æ—Ä–º–∞—Ç –∫–∞–∫ ReadingPosition)
- color?
- textSnippet
- createdAt, updatedAt

**Note**
- id, bookId
- highlightId?
- chapterId?
- title?, body
- tagIds: List
- createdAt, updatedAt, deletedAt?

**Tag**
- id
- name
- createdAt

---

### AI‚Äë–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã (MVP)

**AiArtifact**
- id
- kind: summary | explain | qa
- scopeType: chapter | selection | note | book
- scopeId
- inputHash
- model, createdAt, updatedAt
- status: ready | running | failed
- content
- error?

---

## 4) DTO / persistence –ø–æ–ª—è –¥–ª—è —Å–∏–Ω–∫–∞

–î–æ–±–∞–≤–∏—Ç—å –ø–æ—á—Ç–∏ –≤–æ –≤—Å–µ —Å–∏–Ω–∫–∞—é—â–∏–µ—Å—è —Å—É—â–Ω–æ—Å—Ç–∏:
- rev (–º–æ–Ω–æ—Ç–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
- updatedAt
- deviceId
- isDirty (–ª–æ–∫–∞–ª—å–Ω–æ)
- deletedAt (soft delete)

**–ü—Ä–∏–º–µ—Ä NoteDTO:**
- id, bookId, highlightId?, chapterId?
- title?, body
- tagIds[]
- rev, updatedAt, deletedAt?
- deviceId

---

## 5) –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

- books
- book_assets
- toc_items
- reading_positions
- highlights
- notes
- tags
- note_tags
- ai_artifacts
- sync_queue
