# План разработки CogniRead — MVP0 (локальный) — по дням

Этот план рассчитан на формат: **1 день = 1 PR в `main`**.

## Принципы
- Один день = один PR с понятным diff и проверкой: `flutter analyze` + `flutter test`.
- “Готово” = критерии приёмки + ручной сценарий + тест/проверка.
- Облако/AI **не делаем** в MVP0 (это MVP1/MVP2).

## Definition of Done для каждого дня (коротко)
- [ ] PR в `main`
- [ ] `flutter analyze` — без ошибок (желательно без предупреждений)
- [ ] `flutter test` — зелёный
- [ ] В PR описаны 1–3 ручных сценария проверки
- [ ] Документация обновлена, если менялся scope/архитектура

---

## День 3 — Стабилизация репозитория и границ MVP0
Чеклист:
- [x] Привести `assets/` в порядок: создать папку `assets/` **или** убрать `assets:` из `pubspec.yaml` до появления ресурсов.
- [x] Привести `README.md` и `STATE.md` в соответствие фактической структуре.
- [x] В `docs/spec_mvp.md` разделить scope на **MVP0 / MVP1 / MVP2**.
- [x] В `docs/dod.md` уточнить DoD для PR (линт/тесты/ручная проверка/доки).
- ✅ Контроль: `flutter analyze` и `flutter test` зелёные.

LLM-контроль (D3):
- “Найди противоречия в `spec_mvp.md`. Сформируй 7–10 проверяемых критериев приёмки для MVP0.”

---

## День 4 — Контракты и выбор пакетов для импорта
Чеклист:
- [x] Зафиксировать в `docs/decisions.md` выбор:
  - file picker (desktop/macOS),
  - пути хранения (app-managed storage),
  - epub parsing (минимум метаданные),
  - локальное хранилище (DB/kv).
- [x] Подключить зависимости в `pubspec.yaml`.
- [x] Ввести интерфейсы: `StorageService`, `BookRepository`, модели (Book + DTO/record).
- ✅ Контроль: сборка и тесты проходят; есть хотя бы 1 unit-тест на критический кусок (валидация/Result).

LLM-контроль (D4):
- “Риск-ревью по macOS sandbox и работе с путями/доступами.”

---

## День 5 — UI импорта (выбор файла) + валидация
Чеклист:
- [x] Реальный выбор файла EPUB из LibraryScreen.
- [x] Корректная обработка cancel.
- [x] Валидация: расширение/существование/читаемость.
- [x] Показ ошибок пользователю (snackbar/dialog).
- ✅ Контроль: cancel / не epub / epub ok — отрабатывают корректно.

---

## День 6 — Storage: копирование в управляемую директорию приложения
Чеклист:
- [x] Копирование выбранного EPUB в app-managed storage.
- [x] Конфликты имён: безопасное переименование (суффикс/хэш).
- [x] Атомарность: temp → rename (по возможности).
- ✅ Контроль: исходный файл можно удалить; импортированная книга остаётся доступной.

LLM-контроль (D6):
- “Security review: плохие имена файлов, path traversal, отмена/ошибки доступа.”

---

## День 7 — Извлечение метаданных EPUB (минимум)
Чеклист:
- [x] Извлечь `title` (обязательно), `author` (желательно).
- [x] Fallback: имя файла, если метаданные отсутствуют.
- ✅ Контроль: минимум 3 разные книги → корректный title.

---

## День 8 — Persistence библиотеки (локально)
Чеклист:
- [x] Сохранение списка книг (id, title, author, localPath, addedAt).
- [x] Загрузка при старте.
- [x] Удаление книги: удалить запись + файл.
- ✅ Контроль: перезапуск сохраняет библиотеку; удаление реально удаляет файл.

LLM-контроль (D8):
- “Проверь схему данных: что нужно добавить для позиции/заметок/прогресса.”

---

## День 9 — Reader MVP: открыть и реально читать
Чеклист:
- [ ] Открытие книги по `bookId`.
- [ ] Реальный рендер содержимого (минимальный, без идеальной пагинации допустимо).
- [ ] Экран загрузки/ошибки (битый файл/нет доступа).
- ✅ Контроль: читается хотя бы первая глава/текст, без падений.

---

## День 10 — TOC и навигация по главам
Чеклист:
- [ ] Получить оглавление (TOC).
- [ ] Переход по главам.
- ✅ Контроль: переходы устойчивые, нет “пустых экранов”.

---

## День 11 — Сохранение позиции чтения
Чеклист:
- [ ] Сохранять последнюю позицию (глава + якорь/смещение по возможностям движка).
- [ ] Восстанавливать при открытии.
- ✅ Контроль: закрыть/открыть → продолжает с места.

LLM-контроль (D11):
- “Предложи устойчивый формат позиции и тест-кейсы (смена шрифта/окна/темы).”

---

## Дальше (после MVP0, отдельный этап)
- Поиск по книге
- Highlights/bookmarks
- Notes + экспорт
- Затем MVP1 (sync) и MVP2 (AI) — отдельными фазами
